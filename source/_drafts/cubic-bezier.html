<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
        #app {
            margin: 50px;
            text-align: center;
        }
		svg {
			overflow: visible;
		}
        svg circle {
            fill: #f2f6ed;
            stroke: #83887c;
        }
        svg circle.draggable {
            cursor: pointer;
        }
        svg circle.draggable:hover {
            stroke: #232520;
        }
	</style>
</head>
<meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
<body>
<div id="app">

<svg id="d3" width="120" height="120" viewBox="0 0 120 120">
    <g transform="translate(10, 10)" stroke-width="1.5">
        <g stroke="#83887c" fill="none">
            <path :d="`M0,0C${x1},${y1} ${x2},${y2} 100,100`"></path>
            <line x1="0" y1="0" :x2="x1" :y2="y1"></line>
            <line x1="100" y1="100" :x2="x2" :y2="y2"></line>
        </g>
        <g transform="translate(0, 0)">
            <circle r="5"></circle>
        </g>
        <g transform="translate(100, 100)">
            <circle r="5"></circle>
        </g>
        <g :transform="`translate(${x1}, ${y1})`" @mousedown="handleMousedown" @touchstart="handleMousedown">
            <circle r="5" class="draggable"></circle>
        </g>
        <g :transform="`translate(${x2}, ${y2})`">
            <circle r="5" class="draggable"></circle>
        </g>
    </g>
</svg>

</div>

<script src="../scripts/vue.min.js"></script>
<script>
const app = new Vue({
    el: '#app',
    data: {
        initX1: 50,
        initY1: 0,
        x1: 50,
        y1: 0,
        x2: 50,
        y2: 100,
        
        dragState: {
            dragging: false,
            mouseLeft: 0,
            mouseTop: 0,
        }
    },
    methods: {
        handleMousedown(event) {
            const isTouch = !!event.touches
            if (isTouch && event.touches.length > 1) return

            this.dragging = true

            this.dragState = {
                dragging: true,
                mouseLeft: event.clientX,
                mouseTop: event.clientY
            }

            document.onselectstart = () => false
            document.ondragstart = () => false

            const handleMouseMove = event => {
                const deltaLeft = event.clientX - this.dragState.mouseLeft
                const deltaTop = event.clientY - this.dragState.mouseTop
                this.x1 = 50 + deltaLeft
                this.y1 = deltaTop
            }

            const handleMouseUp = event => {
                if (this.dragState.dragging) {
                    this.dragState.dragging = false
                    this.initX1 = this.x1
                    this.initY1 = this.y1
                }

                document.removeEventListener('mousemove', handleMouseMove)
                document.removeEventListener('mouseup', handleMouseUp)
                document.onselectstart = null
                document.ondragstart = null
            }

            document.addEventListener('mousemove', handleMouseMove)
            document.addEventListener('mouseup', handleMouseUp)
        }
    }
})
</script>
</body>
</html>